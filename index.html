<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Management Web App (Firebase)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    body {
      background: #f5f5f5;
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: #1f2933;
      color: #fff;
      padding: 20px;
    }

    .sidebar h2 {
      margin-bottom: 10px;
      font-size: 22px;
      text-align: center;
    }

    .sidebar form {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar label {
      font-size: 14px;
      margin-bottom: 2px;
    }

    .sidebar input {
      padding: 8px;
      border-radius: 4px;
      border: none;
      outline: none;
    }

    .sidebar button {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      border: none;
      background: #10b981;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .sidebar button:hover {
      background: #059669;
    }

    /* Main content */
    .main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .main-header h1 {
      font-size: 24px;
    }

    .status {
      font-size: 14px;
      color: #4b5563;
    }

    /* Cards grid: 3 per row on large screens */
    .cards-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    @media (max-width: 992px) {
      .cards-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      body {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .cards-container {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .card-body {
      padding: 15px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 5px;
    }

    .card-author,
    .card-price {
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 4px;
    }

    .card-actions {
      margin-top: 10px;
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }

    .btn {
      flex: 1;
      padding: 6px 8px;
      border-radius: 4px;
      border: none;
      font-size: 13px;
      cursor: pointer;
    }

    .btn-update {
      background: #3b82f6;
      color: white;
    }

    .btn-delete {
      background: #ef4444;
      color: white;
    }

    .btn-details {
      background: #6b7280;
      color: white;
    }

    .btn:hover {
      opacity: 0.9;
    }

    /* Simple modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }

    .modal h3 {
      margin-bottom: 10px;
    }

    .modal p {
      margin-bottom: 6px;
    }

    .modal button {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 4px;
      border: none;
      background: #1f2933;
      color: white;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <!-- Sidebar with Add Book Form -->
  <aside class="sidebar">
    <h2>Add New Book</h2>
    <form id="addBookForm">
      <div>
        <label for="title">Title</label>
        <input id="title" type="text" placeholder="Book title" required />
      </div>
      <div>
        <label for="author">Author</label>
        <input id="author" type="text" placeholder="Author name" required />
      </div>
      <div>
        <label for="price">Price</label>
        <input id="price" type="number" min="0" step="0.01" placeholder="Price" required />
      </div>
      <div>
        <label for="imageUrl">Image URL</label>
        <input id="imageUrl" type="url" placeholder="https://example.com/cover.jpg" required />
      </div>
      <button type="submit">Add Book</button>
    </form>
  </aside>

  <!-- Main content area -->
  <main class="main">
    <div class="main-header">
      <h1>Book Management</h1>
      <span class="status" id="statusText">Connecting to Firebase...</span>
    </div>

    <div class="cards-container" id="booksContainer">
      <!-- Book cards will be rendered here -->
    </div>
  </main>

  <!-- Modal for "View Details" -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" id="modal">
      <h3 id="modalTitle"></h3>
      <p id="modalAuthor"></p>
      <p id="modalPrice"></p>
      <p id="modalImage"></p>
      <button id="modalCloseBtn">Close</button>
    </div>
  </div>

  <!-- Firebase + App Script -->
  <script type="module">
    // 1. Import Firebase modules from CDN (Firebase v10+ modules)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      updateDoc,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // 2. Your web app's Firebase configuration
    // ðŸ‘‰ðŸ‘‰ REPLACE THIS OBJECT with your own config from Firebase project settings
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGE_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // 3. Initialize Firebase and Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusText = document.getElementById("statusText");
    const booksContainer = document.getElementById("booksContainer");
    const addBookForm = document.getElementById("addBookForm");

    // Modal elements
    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalAuthor = document.getElementById("modalAuthor");
    const modalPrice = document.getElementById("modalPrice");
    const modalImage = document.getElementById("modalImage");
    const modalCloseBtn = document.getElementById("modalCloseBtn");

    // 4. Real-time listener for books collection
    const booksRef = collection(db, "books"); // collection name: books

    onSnapshot(booksRef, (snapshot) => {
      const books = [];
      snapshot.forEach((docSnap) => {
        books.push({
          id: docSnap.id,
          ...docSnap.data()
        });
      });

      renderBooks(books);
      statusText.textContent = "Connected. Books: " + books.length;
    }, (error) => {
      console.error("Error listening to books:", error);
      statusText.textContent = "Error connecting to Firebase.";
    });

    // 5. Render cards to UI (3 cards per row via CSS grid)
    function renderBooks(books) {
      booksContainer.innerHTML = "";

      if (books.length === 0) {
        booksContainer.innerHTML = "<p>No books found. Add some from the sidebar.</p>";
        return;
      }

      books.forEach((book) => {
        const card = document.createElement("div");
        card.className = "card";

        const img = document.createElement("img");
        img.src = book.coverImageURL || book.imageUrl || "https://via.placeholder.com/300x180?text=No+Image";
        img.alt = book.title;

        const body = document.createElement("div");
        body.className = "card-body";

        const titleEl = document.createElement("div");
        titleEl.className = "card-title";
        titleEl.textContent = book.title;

        const authorEl = document.createElement("div");
        authorEl.className = "card-author";
        authorEl.textContent = "Author: " + book.author;

        const priceEl = document.createElement("div");
        priceEl.className = "card-price";
        priceEl.textContent = "Price: â‚¹" + book.price;

        const actions = document.createElement("div");
        actions.className = "card-actions";

        // Update Author button
        const updateBtn = document.createElement("button");
        updateBtn.className = "btn btn-update";
        updateBtn.textContent = "Update Author";
        updateBtn.addEventListener("click", () => handleUpdateAuthor(book));

        // Delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-delete";
        deleteBtn.textContent = "Delete";
        deleteBtn.addEventListener("click", () => handleDeleteBook(book.id));

        // View Details button
        const detailsBtn = document.createElement("button");
        detailsBtn.className = "btn btn-details";
        detailsBtn.textContent = "View Details";
        detailsBtn.addEventListener("click", () => showDetailsModal(book));

        actions.appendChild(updateBtn);
        actions.appendChild(deleteBtn);
        actions.appendChild(detailsBtn);

        body.appendChild(titleEl);
        body.appendChild(authorEl);
        body.appendChild(priceEl);
        body.appendChild(actions);

        card.appendChild(img);
        card.appendChild(body);

        booksContainer.appendChild(card);
      });
    }

    // 6. Add new book (form submit)
    addBookForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const title = document.getElementById("title").value.trim();
      const author = document.getElementById("author").value.trim();
      const price = parseFloat(document.getElementById("price").value);
      const imageUrl = document.getElementById("imageUrl").value.trim();

      if (!title || !author || !imageUrl || isNaN(price)) {
        alert("Please fill all fields correctly.");
        return;
      }

      try {
        await addDoc(booksRef, {
          title,
          author,
          price,
          coverImageURL: imageUrl
        });
        addBookForm.reset();
        alert("Book added successfully!");
      } catch (error) {
        console.error("Error adding book:", error);
        alert("Error adding book. Check console.");
      }
    });

    // 7. Update author
    async function handleUpdateAuthor(book) {
      const newAuthor = prompt("Enter new author name:", book.author);
      if (!newAuthor || newAuthor.trim() === "") return;

      try {
        const docRef = doc(db, "books", book.id);
        await updateDoc(docRef, { author: newAuthor.trim() });
        alert("Author updated!");
      } catch (error) {
        console.error("Error updating author:", error);
        alert("Error updating author. Check console.");
      }
    }

    // 8. Delete book
    async function handleDeleteBook(bookId) {
      const ok = confirm("Are you sure you want to delete this book?");
      if (!ok) return;

      try {
        const docRef = doc(db, "books", bookId);
        await deleteDoc(docRef);
        alert("Book deleted!");
      } catch (error) {
        console.error("Error deleting book:", error);
        alert("Error deleting book. Check console.");
      }
    }

    // 9. View details modal
    function showDetailsModal(book) {
      modalTitle.textContent = book.title;
      modalAuthor.textContent = "Author: " + book.author;
      modalPrice.textContent = "Price: â‚¹" + book.price;
      modalImage.innerHTML = `Image URL: <a href="${book.coverImageURL}" target="_blank">${book.coverImageURL}</a>`;

      modalBackdrop.style.display = "flex";
    }

    modalCloseBtn.addEventListener("click", () => {
      modalBackdrop.style.display = "none";
    });

    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) {
        modalBackdrop.style.display = "none";
      }
    });

  </script>
</body>
</html>
